<z-layout class="min-h-dvh overflow-hidden">
  <z-sidebar
    class="p-0!"
    [zWidth]="225"
    [zCollapsible]="true"
    [zCollapsed]="sidebarCollapsed()"
    [zCollapsedWidth]="65"
    (zCollapsedChange)="onCollapsedChange($event)"
  >
    <nav [class]="`flex h-full flex-col overflow-hidden ${sidebarCollapsed() ? 'gap-1 p-1 pt-4' : 'gap-4 p-4'}`">
      <z-sidebar-group>
        @if (!sidebarCollapsed()) {
          <app-logo class="mb-4 h-8 w-max" mode="full" />
        } @else {
          <app-logo class="mb-4 h-8 w-8" />
        }

        @for (item of mainMenuItems; track item.label) {
          @if (sidebarCollapsed()) {
            <button
              type="button"
              z-button
              zType="ghost"
              zPosition="right"
              class="justify-center"
              [zTooltip]="item.label"
            >
              <z-icon [zType]="item.icon!" />
            </button>
          } @else {
            <button type="button" z-button zType="ghost" zPosition="right" class="justify-start">
              <z-icon class="mr-1" [zType]="item.icon!" />
              <span>{{ item.label }}</span>
            </button>
          }
        }
      </z-sidebar-group>

      <z-sidebar-group>
        @if (!sidebarCollapsed()) {
          <z-sidebar-group-label>Workspace</z-sidebar-group-label>
        }
        @for (item of workspaceMenuItems; track item.label) {
          @if (item.submenu) {
            @if (sidebarCollapsed()) {
              <button
                type="button"
                z-button
                zType="ghost"
                z-menu
                zPlacement="rightTop"
                zPosition="right"
                class="w-full justify-center"
                [zMenuTriggerFor]="submenu"
                [zTooltip]="item.label"
              >
                <z-icon [zType]="item.icon!" />
              </button>
            } @else {
              <button
                type="button"
                z-button
                zType="ghost"
                z-menu
                zPlacement="rightTop"
                zPosition="right"
                class="w-full justify-start"
                [zMenuTriggerFor]="submenu"
              >
                <z-icon class="mr-1" [zType]="item.icon!" />
                <span class="flex-1 text-left">{{ item.label }}</span>
                <z-icon zType="chevron-right" />
              </button>
            }

            <ng-template #submenu>
              <div z-menu-content class="w-48">
                @for (subitem of item.submenu; track subitem.label) {
                  <button type="button" z-menu-item>{{ subitem.label }}</button>
                }
              </div>
            </ng-template>
          } @else {
            @if (sidebarCollapsed()) {
              <button
                type="button"
                z-button
                zType="ghost"
                zPosition="right"
                class="w-full justify-center"
                [zTooltip]="item.label"
              >
                <z-icon [zType]="item.icon!" />
              </button>
            } @else {
              <button type="button" z-button zType="ghost" zPosition="right" class="w-full justify-start">
                <z-icon class="mr-1" [zType]="item.icon!" />
                <span>{{ item.label }}</span>
              </button>
            }
          }
        }
      </z-sidebar-group>

      <div class="mt-auto">
        @if (sessionService.isLoggedIn()) {
          <div
            z-menu
            zPlacement="rightBottom"
            [zMenuTriggerFor]="userMenu"
            [class]="
              `hover:bg-accent flex w-full cursor-pointer items-center gap-2 rounded-md ${sidebarCollapsed() ? 'm-2 justify-center p-0' : 'justify-start p-2'}`
            "
          >
            <z-avatar
              zSrc="https://zardui.com/images/avatar/imgs/avatar_image.jpg"
              zAlt="User Avatar"
              class="h-10 w-10 shrink-0"
            />

            <div
              class="min-w-0 overflow-hidden"
              [class]="sidebarCollapsed() ? 'max-w-0 opacity-0' : 'max-w-[200px] opacity-100'"
            >
              <span class="font-medium">zardui</span>
              <div class="text-xs">test&#64;zardui.com</div>
            </div>

            <z-icon
              zType="chevrons-up-down"
              class="ml-auto h-4 w-4 shrink-0"
              [class]="sidebarCollapsed() ? 'opacity-0' : 'opacity-100'"
            />
          </div>
        } @else {
          <z-icon [zType]="logInIcon" />
        }

        <ng-template #userMenu>
          <div z-menu-content class="w-48">
            <button type="button" z-menu-item>
              <z-icon zType="user" class="mr-2" />
              Profile
            </button>
            <button type="button" z-menu-item>
              <z-icon zType="settings" class="mr-2" />
              Settings
            </button>
            <z-divider zSpacing="sm" />
            <button type="button" z-menu-item>
              <z-icon zType="log-out" class="mr-2" />
              Logout
            </button>
          </div>
        </ng-template>
      </div>
    </nav>
  </z-sidebar>

  <z-content class="min-h-50">
    <div class="flex items-center">
      <button type="button" z-button zType="ghost" zSize="sm" class="-ml-2" (click)="toggleSidebar()">
        <z-icon zType="panel-left" />
      </button>

      <z-divider zOrientation="vertical" class="ml-2 h-4" />

      <z-breadcrumb zWrap="wrap" zAlign="start">
        <z-breadcrumb-item [routerLink]="['/']">Home</z-breadcrumb-item>
        <z-breadcrumb-item>
          <span aria-current="page">Components</span>
        </z-breadcrumb-item>
      </z-breadcrumb>
    </div>

    <div class="space-y-4 py-4">
      <router-outlet (activate)="onOutletActivate()" (deactivate)="onOutletDeactivate()" />
      @if (!outletActivated()) {
        <z-skeleton class="h-80 w-full" />
        <z-skeleton class="h-16 w-full" />
      }
    </div>
  </z-content>
</z-layout>
